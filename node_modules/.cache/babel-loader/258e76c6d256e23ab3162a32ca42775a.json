{"ast":null,"code":"var _jsxFileName = \"/Users/sarahcosta/Git/m3/s05-09/react-entrega-s2-formulario-de-cadastro-sarahvenske/src/context/UserContext.jsx\",\n    _s = $RefreshSig$();\n\nimport { createContext, useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport api from '../components/Api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const UserContext = /*#__PURE__*/createContext({});\n\nconst UserProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n  useEffect(() => {\n    async function autoLogin() {\n      const token = localStorage.getItem(\"@context-kenziehub:token\");\n\n      if (token) {\n        try {\n          api.defaults.headers.Authorization = `Bearer ${token}`;\n          const {\n            data\n          } = await api.get(\"/profile\");\n          setUser(data);\n        } catch (error) {\n          localStorage.clear();\n        }\n      }\n\n      setLoading(false);\n    }\n\n    autoLogin();\n  }, []);\n\n  const userLogin = data => {\n    api.post(\"/sessions\", data).then(response => {\n      const {\n        user: userResponse,\n        token\n      } = response.data;\n      api.defaults.headers.authorization = `Bearer ${token}`;\n      setUser(userResponse);\n      localStorage.setItem(\"@context-kenziehub:token\", token);\n      navigate(\"/dashboard\", {\n        replace: true\n      });\n    }).catch(error => {\n      toast.error(\"Ops! Algo deu errado\");\n    });\n  };\n\n  const userSignup = user => {\n    api.post(\"/users\", user).then(response => {\n      toast.success(\"Conta criada com sucesso!\");\n      navigate(\"/\");\n    }).catch(error => {\n      toast.error(\"Ops! Algo deu errado\");\n    });\n  };\n\n  const userLogout = () => {\n    setUser(null);\n    localStorage.clear();\n    navigate(\"/\", {\n      replace: true\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: {\n      user,\n      setUser,\n      loading,\n      userLogin,\n      userSignup,\n      userLogout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 9\n  }, this);\n};\n\n_s(UserProvider, \"lk6viekuCMMpYORkLYLEq0Wsfds=\", false, function () {\n  return [useNavigate];\n});\n\n_c = UserProvider;\nexport default UserProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"names":["createContext","useEffect","useState","useNavigate","toast","api","UserContext","UserProvider","children","user","setUser","loading","setLoading","navigate","autoLogin","token","localStorage","getItem","defaults","headers","Authorization","data","get","error","clear","userLogin","post","then","response","userResponse","authorization","setItem","replace","catch","userSignup","success","userLogout"],"sources":["/Users/sarahcosta/Git/m3/s05-09/react-entrega-s2-formulario-de-cadastro-sarahvenske/src/context/UserContext.jsx"],"sourcesContent":["import {createContext, useEffect, useState} from 'react'\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify'\nimport api from '../components/Api';\n\n\nexport const UserContext = createContext({});\n\nconst UserProvider = ({children}) => {\n\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const navigate = useNavigate();\n\n    useEffect(() => {\n\n        async function autoLogin(){\n            const token = localStorage.getItem(\"@context-kenziehub:token\");\n                if(token){\n                    try{\n                        api.defaults.headers.Authorization = `Bearer ${token}`;\n                        const { data } = await api.get(\"/profile\");\n                        setUser(data);\n                    } catch (error){\n                        localStorage.clear();\n                    }\n                }\n                setLoading(false);\n            } \n            autoLogin();\n\n    }, []);\n\n    const userLogin = (data) => {\n\n        api.post(\"/sessions\", data)\n        .then((response) => {\n            const {user: userResponse, token } = response.data \n            api.defaults.headers.authorization = `Bearer ${token}`;\n            setUser(userResponse)\n            localStorage.setItem(\"@context-kenziehub:token\", token)\n            navigate(\"/dashboard\", {replace: true})\n        }).catch((error) => {\n            toast.error(\"Ops! Algo deu errado\")\n        })\n    }\n\n    const userSignup = (user) => {\n      \n        api.post(\"/users\", user)\n        .then((response) => {\n          toast.success(\"Conta criada com sucesso!\")\n          navigate(\"/\")\n        })\n        .catch((error) => {\n          toast.error(\"Ops! Algo deu errado\");\n        })\n      }\n\n    const userLogout = () => {\n\n        setUser(null)\n        localStorage.clear()\n        navigate(\"/\", {replace: true})\n    }\n    \n    return(\n        <UserContext.Provider value={{ user, setUser, loading, userLogin, userSignup, userLogout}}>\n            {children}\n        </UserContext.Provider>\n    )\n}\n\nexport default UserProvider;"],"mappings":";;;AAAA,SAAQA,aAAR,EAAuBC,SAAvB,EAAkCC,QAAlC,QAAiD,OAAjD;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,SAASC,KAAT,QAAsB,gBAAtB;AACA,OAAOC,GAAP,MAAgB,mBAAhB;;AAGA,OAAO,MAAMC,WAAW,gBAAGN,aAAa,CAAC,EAAD,CAAjC;;AAEP,MAAMO,YAAY,GAAG,QAAgB;EAAA;;EAAA,IAAf;IAACC;EAAD,CAAe;EAEjC,MAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBR,QAAQ,CAAC,IAAD,CAAhC;EACA,MAAM,CAACS,OAAD,EAAUC,UAAV,IAAwBV,QAAQ,CAAC,IAAD,CAAtC;EACA,MAAMW,QAAQ,GAAGV,WAAW,EAA5B;EAEAF,SAAS,CAAC,MAAM;IAEZ,eAAea,SAAf,GAA0B;MACtB,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,0BAArB,CAAd;;MACI,IAAGF,KAAH,EAAS;QACL,IAAG;UACCV,GAAG,CAACa,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,GAAsC,UAASL,KAAM,EAArD;UACA,MAAM;YAAEM;UAAF,IAAW,MAAMhB,GAAG,CAACiB,GAAJ,CAAQ,UAAR,CAAvB;UACAZ,OAAO,CAACW,IAAD,CAAP;QACH,CAJD,CAIE,OAAOE,KAAP,EAAa;UACXP,YAAY,CAACQ,KAAb;QACH;MACJ;;MACDZ,UAAU,CAAC,KAAD,CAAV;IACH;;IACDE,SAAS;EAEhB,CAjBQ,EAiBN,EAjBM,CAAT;;EAmBA,MAAMW,SAAS,GAAIJ,IAAD,IAAU;IAExBhB,GAAG,CAACqB,IAAJ,CAAS,WAAT,EAAsBL,IAAtB,EACCM,IADD,CACOC,QAAD,IAAc;MAChB,MAAM;QAACnB,IAAI,EAAEoB,YAAP;QAAqBd;MAArB,IAA+Ba,QAAQ,CAACP,IAA9C;MACAhB,GAAG,CAACa,QAAJ,CAAaC,OAAb,CAAqBW,aAArB,GAAsC,UAASf,KAAM,EAArD;MACAL,OAAO,CAACmB,YAAD,CAAP;MACAb,YAAY,CAACe,OAAb,CAAqB,0BAArB,EAAiDhB,KAAjD;MACAF,QAAQ,CAAC,YAAD,EAAe;QAACmB,OAAO,EAAE;MAAV,CAAf,CAAR;IACH,CAPD,EAOGC,KAPH,CAOUV,KAAD,IAAW;MAChBnB,KAAK,CAACmB,KAAN,CAAY,sBAAZ;IACH,CATD;EAUH,CAZD;;EAcA,MAAMW,UAAU,GAAIzB,IAAD,IAAU;IAEzBJ,GAAG,CAACqB,IAAJ,CAAS,QAAT,EAAmBjB,IAAnB,EACCkB,IADD,CACOC,QAAD,IAAc;MAClBxB,KAAK,CAAC+B,OAAN,CAAc,2BAAd;MACAtB,QAAQ,CAAC,GAAD,CAAR;IACD,CAJD,EAKCoB,KALD,CAKQV,KAAD,IAAW;MAChBnB,KAAK,CAACmB,KAAN,CAAY,sBAAZ;IACD,CAPD;EAQD,CAVH;;EAYA,MAAMa,UAAU,GAAG,MAAM;IAErB1B,OAAO,CAAC,IAAD,CAAP;IACAM,YAAY,CAACQ,KAAb;IACAX,QAAQ,CAAC,GAAD,EAAM;MAACmB,OAAO,EAAE;IAAV,CAAN,CAAR;EACH,CALD;;EAOA,oBACI,QAAC,WAAD,CAAa,QAAb;IAAsB,KAAK,EAAE;MAAEvB,IAAF;MAAQC,OAAR;MAAiBC,OAAjB;MAA0Bc,SAA1B;MAAqCS,UAArC;MAAiDE;IAAjD,CAA7B;IAAA,UACK5B;EADL;IAAA;IAAA;IAAA;EAAA,QADJ;AAKH,CA/DD;;GAAMD,Y;UAIeJ,W;;;KAJfI,Y;AAiEN,eAAeA,YAAf"},"metadata":{},"sourceType":"module"}